<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <title>Summarization Viewer</title>

  <link rel="stylesheet" type="text/css" href="css/theme/jquery-ui.min.css" />
  <link rel="stylesheet" type="text/css" href="css/summary-08.min.css" />

  <script src='js/req.min.js'></script>
  <script>
var development = true;
if (development === true)
{
    // Define development script dependencies
    Req.assets = {
        'preloadImages':{ src: 'js/preloadImages.js' },

        'underscore':   { src: 'js/underscore.js' },

        'jquery':       {
            src:    'js/jquery.js',
    
            // script.onload handler that runs as soon as the script has loaded
            onload: function () {
                // be strict about jQuery usage.
                //var $ = jQuery.noConflict();
    
                // Setup an easy-to-use Req.js plugin for jQuery ($.Req)
                $.fn.Req = function(){
                    var args = arguments, t = this;
                    if (t.length)
                    {
                        Req.apply(null, $.map(args, function(a) {
                            return $.isFunction(a)
                                    ? function(){a.call(t);}
                                    : a;
                        }) );
                    }
                    return t;
                };
            }
        },
        'utils':        { src: 'js/jquery.utils.js',  req:['jquery']},

        'backbone':     { src: 'js/backbone.js',
                          req: ['underscore', 'jquery']},
        'backbone.localStorage':
                        { src: 'js/backbone.js',      req:['backbone']},

        // Backbone models
        'model.user':   { src: 'js/model/user.js',    req:['backbone']},
        'model.comment':{ src: 'js/model/comment.js', req:['backbone']},
        'model.range':  { src: 'js/model/range.js',   req:['backbone']},
        'model.note':   { src: 'js/model/note.js',
                          req: [ 'model.comment', 'model.range' ]},
        'model.sentence':
                        { src: 'js/model/sentence.js',req:['backbone']},
        'model.paragraph':
                        { src: 'js/model/paragraph.js',
                                                      req:['model.sentence']},
        'model.section':{ src: 'js/model/section.js', req:['model.paragraph']},
        'model.doc':    { src: 'js/model/doc.js',     req:['model.section']},

        // Backbone helpers
        'helper.click': { src: 'js/helper/click.js',
                          req: ['backbone', 'jquery']},

        // Backbone views
        'view.sentence':{ src: 'js/view/sentence.js',
                          req: ['backbone',
                                'model.sentence',
                                'helper.click',
                                'jquery']},
        'view.paragraph':
                        { src: 'js/view/paragraph.js',
                          req: ['model.paragraph',
                                'view.sentence',
                                'helper.click',
                                'jquery']},
        'view.section': { src: 'js/view/section.js',
                          req: ['model.section', 'view.paragraph', 'jquery']},
        'view.doc':     { src: 'js/view/doc.js',
                          req: ['model.doc', 'view.section', 'jquery']},

        // Rangy and plugins
        'rangy':        { src: 'js/rangy.js' },
        'rangy.serializer':
                        { src: 'js/rangy/serializer.js',req: ['rangy'] },

        // jQuery-ui and widgets
        'jquery-ui':    { src: 'js/jquery-ui.js',       req: ['jquery'] },
    
        'ui.checkbox':  { src: 'js/ui.checkbox.js',     req: ['jquery-ui'] },
    
        // Final suummary app
        'summary':      { src: 'js/jquery.summary-08.js',
                          req: [ 'model.user', 'model.comment', 'model.note',
                                 'view.doc',
                                 'jquery', 'utils',
                                 'rangy.serializer',
                                 'ui.checkbox'
                          ] }
    };
}
else
{
    // Define production script dependencies
    Req.assets = {
        'preloadImages':{ src: 'js/preloadImages.min.js' },
        'summary':      { src: 'js/summary-08-full.js' }
    };
}

var docId = (window.location.search
              ? window.location.search
                  .replace(/^\?(?:\/?samples\/?)?([^\.\/]+)(?:\.json|\.xml)?$/, '$1')
              : '0001a');

Req('preloadImages', function() {
        // Preload global images/sprites
        preloadImages('css/images/loading.gif', 'css/images/icons-16.png');
    },
    'summary', function() {
        var $ = jQuery.noConflict();

        $(document).ready(function() {
            // Initialize the application
            this.appSummary = new $.Summary({
                el:     $('#app-Summary'),
                doc:    'samples/'+ docId +'.json'
            });
        });
    }
);
  </script>
 </head>
 <body>
  <div id='app-Summary'><!-- app.Summary { -->
   <div class='margin-left'><!-- margin-left { -->
    <div class='control-pane' style='display:none;'><!-- control-pane { -->
     <div class='controls ui-layout-north'><!-- controls { -->
      <div class='filter'><!-- filter { -->
       <label for="filter" class='primary'>Filter</label>
       <input name="filter" id="filter-tagged"
              type="checkbox" value="tagged" />
       <label for="filter-tagged">sentences with notes:</label>
      </div><!-- filter } -->

      <div class='threshold'><!-- threshold { -->
       <label for="threshold" class='primary'>Threshold</label>
       <label class='values'></label>

       <div class='buttons'>
        <div class='expansion'>
         <button name='threshold-down'
                title='expand'><div
                class='expand su-icon su-icon-expand' /></button
        ><button name='threshold-up'
                title='collapse'><div
                class='collapse su-icon su-icon-collapse' /></button>
        </div>
        <div class='global'>
         <button  name='threshold-all'
                 title='full document'><div
                class='all su-icon su-icon-all' /></button
        ><button name='threshold-reset'
                title='reset to original threshold'><div
                class='reset su-icon su-icon-reset' /></button>
        </div>
       </div>
      </div><!-- threshold } -->

      <div class='options'><!-- options { -->
       <label for="options" class='primary'>Options</label>
       <input name="quickTag" id="options-quickTag"
              type="checkbox" value="normal" />
       <label for="options-quickTag">quick tag:</label>
      </div><!-- options } -->
     </div><!-- controls } -->
    </div><!-- control-pane } -->
   </div><!-- margin-left } -->
   <div class='content-pane'><!-- content-pane { -->
   </div><!-- content-pane } -->
   <div class='margin-right'><!-- margin-right { -->
    <div class='tags-pane'></div>
    <div class='notes-pane'></div>
   </div><!-- margin-right } -->
  </div><!-- app.Summary } -->
 </body>

 <!-- Templates { -->
 <script id='template-doc-full' type='text/template'>
  <header>
   <h1><a href="<%= get("url") %>"><%= get("title") %></a></h1>
   <author><%= get("author") %></author>
   <time datetime="<%= get("published").toISOString() %>"
          pubdate="true"><%= jQuery.date2str(get("published")) %></time>
   <div class="keywords">
    <% _.each(get("keywords"), function(keyword) { %>
        <div class="keyword"
             rank="<%= Math.floor(keyword.rank * 100) %>"
            forms="<%= keyword.forms.join(",") %>"><%= keyword.name %></div>
    <% }); %>
   </div>
  </header>
  <% _.each(get("sections").toJSON(), function(section) { %>
    <section rank="<%= Math.floor(section.rank * 100) %>">
     <% _.each(section.paragraphs.toJSON(), function(paragraph) {
      %><p rank="<%= Math.floor(paragraph.rank * 100) %>"
       ><span class="controls">&para;</span
       ><% _.each(paragraph.sentences.toJSON(), function(sentence) {
            var rank = Math.floor(sentence.rank * 100);
        %><span class="sentence"
                rank="<%= rank %>"
          ><span class="rank"><%= rank %></span
          ><%= sentence.content %></span
       ><% }); %></p>
     <% }); %>
    </section>
  <% }); %>
 </script>

 <script id='template-doc' type='text/template'>
  <header>
   <h1><a href="<%= url %>"><%= title %></a></h1>
   <author><%= author %></author>
   <time datetime="<%= published.toISOString() %>"
          pubdate="true"><%= jQuery.date2str(published) %></time>
   <div class="keywords">
    <% _.each(keywords, function(keyword) { %>
        <div class="keyword"
             rank="<%= Math.floor(keyword.rank * 100) %>"
            forms="<%= keyword.forms.join(",") %>"><%= keyword.name %></div>
    <% }); %>
   </div>
  </header>
  <div class='sections'></div>
 </script>

 <script id='template-section' type='text/template'>
  <div class='paragraphs'></div>
 </script>

 <script id='template-paragraph' type='text/template'>
  <span class="controls">&para;</span>
  <div class='sentences'></div>
 </script>

 <script id='template-sentence' type='text/template'
  ><span class="overlay"></span
  ><span class="rank"><%= Math.floor(rank * 100) %></span
  ><span class="content"><%= content %></span></script>
 <!-- Templates } -->
</html>
